[
  {
    "model": "utl_files.utlfile",
    "pk": 30220,
    "fields": {
      "pkg": "core-asset-index-lead_presentation",
      "file_path": "includes/block.utl",
      "file_text": "[% /*   Name: core-asset-index-lead_presentation\n        Updated: 5.20.13 ~ mgorman\n                                Added truncate_length property.\n        Updated: 7.14.10 ~ cricketts \n                Removed float_thumb_headline property as\n                it wasn't useful. This will not effect\n                sites as this state is the default\n                the float_lead_p setting is still \n                effective\n        ::::::::::::::::::::::::::::::::::::::::::::::::\n        Custom Property Options:\n        ------------------------------------------------\n        'byline'\n        If set to true the byline will display. Default\n        is 'false'\n        ------------------------------------------------\n        'byline_text'\n        Setting this value will alter the text that \n        precedes the byline. Setting it to 'false' will\n        turn off the byline_text.\n        ------------------------------------------------\n        'preview_width'\n        entering this property will cause the template\n        to attempt to pull a preview of the specified \n        width.\n        ------------------------------------------------\n        'photo_caption'\n        Set value to 'true' to toggle the caption to \n        display below the image.\n        Default is 'false'\n        ------------------------------------------------\n        'photo_credit'\n        Set value to true to toggle the photo credit to\n        display below the image.\n        Default is 'false'\n        ------------------------------------------------\n        'photo_credit_text'\n        Sets the photo credit text to the provided value.\n        Default is 'Photo by: '\n        NOTE: dependant upon property 'photo_credit' \n        value of 'true'\n        ------------------------------------------------\n        'updated_text'\n        If 'update_text' is entered the text will be \n        displayed before the date. (if 'Last Updated' is \n        entered, the output will be: \n        'Last Updated: February 23')\n        * Default is 'updated: '\n        ------------------------------------------------ \n        'posted_text'\n        If 'posted_text' is entered the text will be \n        displayed before the date. (if 'Posted On' is \n        entered, the output will be: \n        'Posted On: February 23')\n        * Default is 'posted: '\n        ------------------------------------------------ \n        'related_text'\n        Sets the text that displays as a label for the \n        related items.\n        * Default is 'related items'\n        ------------------------------------------------ \n        'title_sublink1' & 'title_sublink1_text'\n        (Four title_sublinks are available. 1-4)\n        Assigning a value to 'title_sublink1' will\n        create a link that floats to the right of the \n        block title. Setting 'title_sublink1_text' will \n        determine the display text for the link.\n        NOTE: If only 'title_sublink1' is entered the \n        link and link text will both use this value.\n        Examples: If \"news\" is entered into \n        'title_sublink1' the link will go to /news and\n        the link text will be news. If \n        'title_sublink1_text' is then link text will be\n        \"local news\"\n        ..href=\"/news\">local news<..\n        * NOTE: This has been deprecated for \"link1\"\n        and \"link2.\"\n        ------------------------------------------------ \n        'float_thumb_lead_p'\n        Setting this property to true will change the \n        location of the photo thumb to float to the left\n        of the paragraph.\n        ------------------------------------------------ \n        'use_full_image'\n        Setting this value to 'true' will tell the block\n        to use the full size image instead of a preview. \n        NOTE: Should be used only when absolutley \n        necessary.\n        ------------------------------------------------ \n        'rss_query'\n        If entered the rss link will search for this\n        value\n        ------------------------------------------------\n        'rss_section'\n        You can change the section in the event that it\n        is not in a first level directory\n        ------------------------------------------------\n    */\n            \n/* only begin work if assets are available */\nif this.block.assets | length > 0;  \n\nlazyLoad = core_base_library_getCustomProperty('lazy_load', 'boolean', false);\nplaceHolder = cms.page.cdn('components/core_external_jquery_plugins/resources/images/place_holder.png');\n\n/* load base component */\nif !cms.component.load('core_base_library'); echo '<!--Failed to load core_base_library component.-->'; end;    \n             \n    /* use master variable to determine predefined block variable set */ \n        /* set toggle variables for block varibale set */\n        byline = 'false';\n            byline_text = '';\n        preview_width = 300;\n        rss_link = 'true';\n        rss_query = 'false';\n        section_title = 'false';\n        headline = 'true';\n        headline_top = 'false';\n        show_flags = 'true';\n        show_new_updated = 'true';\n        child_icons = 'true';\n        thumb = 'true';\n        use_full_image = 'false';\n        /*float_thumb_headline = 'false';*/\n        float_thumb_lead_p = 'false';\n        photo_credit = 'false';\n            photo_credit_text = 'Photo by: ';\n        photo_caption = 'false';    \n        lead_p = 'true';\n        more_link = 'false';\n            more_link_text = 'more';\n        updated_icon = 'true';  \n        updated = 'true';\n            updated_text = 'Updated: ';\n            posted_text = 'Posted: ';\n        comment_count = 'true';\n        keyword_tags = 'true';\n        related = 'true';\n            related_text = 'related items';         \n        truncate_length = 0;\n%]\n\n[%  /* use additional custom block variables to override predefined block variable set \n*/  custom = this.block.custom;\n    if custom.byline; byline = custom.byline; end;\n        if custom.byline_text; byline_text = custom.byline_text; end;\n    if custom.preview_width; preview_width = custom.preview_width; end;\n    if custom.rss_link; rss_link = custom.rss_link; end;\n    if custom.rss_query; rss_query = custom.rss_query; end;\n    if custom.title; title = custom.title; end;\n    if custom.section_title; section_title = custom.section_title; end;\n    if custom.show_flags; show_flags = custom.show_flags; end;\n    if custom.show_new_updated; show_new_updated = custom.show_new_updated; end;\n    if custom.child_icons; child_icons = custom.child_icons; end;\n    if custom.thumb; thumb = custom.thumb; end;\n    if custom.headline_top; headline_top = custom.headline_top; end;\n    /*if custom.float_thumb_headline; float_thumb_headline = custom.float_thumb_headline; end;*/\n    if custom.float_thumb_lead_p; float_thumb_lead_p = custom.float_thumb_lead_p; end;\n    if custom.photo_credit; photo_credit = custom.photo_credit; end;\n        if custom.photo_credit_text; photo_credit_text = custom.photo_credit_text; end;\n    if custom.photo_caption; photo_caption = custom.photo_caption; end; \n    if custom.lead_p; lead_p = custom.lead_p; end;\n    if custom.truncate_length; truncate_length = custom.truncate_length; end;\n    if custom.more_link; more_link = custom.more_link; end;\n        if custom.more_link_text; more_link_text = custom.more_link_text; end;\n    if custom.updated; updated = custom.updated; end;\n    if custom.updated_icon; updated_icon = custom.updated_icon; end;\n        if custom.updated_text; updated_text = custom.updated_text+' '; end;\n        if custom.posted_text; posted_text = custom.posted_text+' '; end;\n    if custom.comment_count; comment_count = custom.comment_count; end;\n    if custom.keyword_tags; keyword_tags = custom.keyword_tags; end;\n    if custom.related; related = custom.related; end;\n        if custom.related_text; related_text = custom.related_text; end;\n    if custom.use_full_image; use_full_image = custom.use_full_image; end;      \n%]\n\n[% macro photo_text %]\n    [%  if photo_credit == 'true' && credit %]\n        <div class=\"photo-byline\">  \n        [%  photo_credit_text;\n            credit | html; credit %]\n        </div>  \n    [%  end; /* photo_credit */\n        if photo_caption == 'true' && caption %]\n        <div class=\"photo-cutline\">\n            [% caption | html;  caption %]\n        </div>\n    [%  end; /* photo caption */        \nend /* photo_text macro */ %]\n\n[% /* end macros */ %]\n    \n<div class=\"blox-top-story\">\n    [% if this.block.title %]\n    <div class=\"blox-title\">\n        [% core_base_library_rss_link('tBlock': this.block);\n        core_base_library_sublinks_dep('tBlock': this.block); /* This macro is depreciated and is included for BC. */\n        core_base_library_title('tBlock': this.block) %]\n        </div>\n    [% core_base_library_sublinks('tBlock': this.block);\n    end;\n        /* top-story-holder start */ %]\n    <div class=\"blox-top-story-holder\">\n[% foreach this.block.assets as asset;\n    if asset | iterfirst;   \n        core_base_library_overline(target : asset);\n                if asset.type == 'image' && use_full_image == 'false';\n                    photo = asset.preview([preview_width]);\n                    caption = asset.description;\n                    credit = asset.byline;\n                else if asset.type == 'image' && use_full_image == 'true';\n                    photo = asset.preview([preview_width]);\n                    caption = asset.description;\n                    credit = asset.byline;\n                    photo.url = asset.resource_url; \n                else;   \n                    if asset.preview([preview_width]);\n                        photo = asset.preview([preview_width]);\n                        caption = asset.description;\n                        credit = asset.byline;\n                    else;   \n                        if use_full_image == 'true';\n                            photo = asset.items('type':'image')[0].preview([preview_width]);\n                            photo.url = asset.items('type':'image')[0].resource_url;\n                        else;\n                            if asset.items('type':'image')[0].presentation == 'mugshot';\n                                photo = asset.items('type':'image')[0].preview([preview_width]);\n                                if !photo;\n                                    photo = asset.items('type':'image')[0].preview([100]);\n                                end;    \n                                small = true;\n                            else;\n                                photo = asset.items('type':'image')[0].preview([preview_width]);\n                            end;\n                                                        ;\n                        end;\n                                                presentation = asset.items('type':'image')[0].presentation;\n                        caption = asset.items('type':'image')[0].description;\n                        credit = asset.items('type':'image')[0].byline;\n                    end;\n                end;    /* end photo assignment */\n                /*if photo.width > (photo.height + 10); horizontal_photo = true; end;*/\n                /* if portrait, force float_thumb_lead_p */\n                /*if photo.width < (photo.height - 10);\n                    float_thumb_headline = 'false';\n                    float_thumb_lead_p = 'true';\n                end;*/\n                /* end photo precessing */\n                if asset.related | length > 0;\n                    has_related_items = true;\n                else;\n                    has_related_items = false;  \n                end;\n                icon_in_place = 'false';\n            %]\n        [% if headline == 'true' && headline_top == 'true' %]\n        <h3 class=\"blox-headline\"><a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">[% asset.title | strip_tags %]</a></h3>\n        [% end; \n           if photo == true && thumb == 'true' && float_thumb_lead_p == 'false'; /* && float_thumb_headline == 'false' */ %]\n               <style>\n                   [%- if presentation == 'cutout'; %]\n                       div.lead-presentation-photo {\n                           border: none;\n                           background: transparent;\n                           padding: 0\n                       }\n                   [%- end; %]\n               </style>\n        <div class=\"lead-presentation-photo[%- if horizontal_photo == 'true'; echo ' horizontal'; end -%]\"[% if custom.preview_width %] style=\"width: [% custom.preview_width %]px\"[% else if small %] style=\"width:100px;\"[% end %]>\n            <div class=\"photo-container\">\n            <a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n                [% if lazyLoad %]\n                                    <img class=\"blox-img-loader story-image [% presentation %]\" alt=\"[% caption | html %]\" src=\"[% placeHolder %]\" data-original=\"[% photo.url %]\" [% if custom.preview_width %]style=\"width: [% custom.preview_width %]px\"[% else if small %] style=\"width:100px;\"[% end %] />\n                                [% else %]\n                                    <img class=\"story-image [% presentation %]\" alt=\"[% caption | html %]\" src=\"[% photo.url %]\" [% if custom.preview_width %]style=\"width: [% custom.preview_width %]px\"[% else if small %] style=\"width:100px;\"[% end %] />\n                                [% end %]\n            </a>\n            </div>\n        [%  photo_text %]\n        </div>\n        [% end %]\n        <div class=\"blox-asset-content[%- if horizontal_photo == 'true'; echo ' horizontal'; end; -%][% if (photo && !has_related_items) || (!photo && has_related_items) %] blox-asset-content-extension[% end; if float_thumb_lead_p == 'true' %] blox-photo-variant[% end %][% if this.block.custom.service_classes | strbool == true; echo core_base_library_serviceClasses(asset);end; %]\" [% if !has_related_items && !photo %]style=\"width:100%;\"[% end %]>\n            [% if section_title == 'true' %]\n                <h3>[% asset.tags('section') %]</h3>\n            [% end %]\n            [% if headline == 'true' && headline_top != 'true' %]\n            <h3 class=\"blox-headline\"><a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">[% asset.title | strip_tags %]</a></h3>\n            [% end %]\n            [% if child_icons == 'true' || show_flags == 'true' || show_new_updated == 'true' || this.block.custom.service_classes | strbool == true %] \n            <ul class=\"blox-icons\">\n                [% if this.block.custom.service_classes | strbool == true;\n                    core_base_library_premiumFlag(asset); end %]                    \n                [% if show_flags == 'true' %]\n                <li>[% core_base_library_assetFlags(target : asset) %]</li>[% end %]\n                [% if show_new_updated == 'true' %]\n                <li>[% core_base_library_new_updated(target : asset) %]</li>[% end %]\n                [% if child_icons == 'true' %]\n                <li>[% core_base_library_child(target : asset) %]</li>[% end %]\n            </ul>\n            [% end %]\n            [% if photo == true && thumb == 'true' && float_thumb_lead_p == 'true' %]\n            <div class=\"lead-presentation-photo\"[% if custom.preview_width %] style=\"width: [% custom.preview_width %]px\"[% else if small %] style=\"width:100px;\"[% end %]>\n                <div class=\"photo-container\">\n                <a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n                                    [% if lazyLoad %]\n                    <img class=\"blox-img-loader story-image story-image-floating\" alt=\"[% caption | html %]\" src=\"[% placeHolder %]\" data-original=\"[% photo.url %]\" [% if custom.preview_width %]style=\"width: [% custom.preview_width %]px\"[% else if small %] style=\"width:100px;\"[% end %] />\n                                    [% else %]\n                                        <img class=\"story-image story-image-floating\" alt=\"[% caption | html %]\" src=\"[% photo.url %]\" [% if custom.preview_width %]style=\"width: [% custom.preview_width %]px\"[% else if small %] style=\"width:100px;\"[% end %] />\n                                    [% end %]\n                </a>\n                </div>\n            [%  photo_text %]\n            </div>\n            [% end %]\n            [%  if byline == 'true' && asset.byline %]\n                <p class=\"byline\">\n                    [% if byline_text != 'false'; byline_text; echo ' '; end; asset.byline %]\n                </p>\n            [%  end %]\n            [% core_base_library_lead_p(target : asset, tBlock : this.block) %]\n            [% if updated == 'true' || comment_count == 'true' || (keyword_tags == 'true' && asset.tags('type':'keyword')) %]\n            <ul class=\"blox-comments\">\n                [% if updated == 'true' %]\n                <li>\n                    [% if updated_icon != 'false' %]\n                                            [% if lazyLoad %]\n                                                <img class=\"blox-img-loader\" src=\"[% placeHolder %]\" data-original=\"global/resources/images/icon-03.gif\" alt=\"icon\" />\n                                            [% else %]\n                                                <img src=\"global/resources/images/icon-03.gif\" alt=\"icon\" />\n                                            [% end %]\n                    [% end %]\n                    <span class=\"blox-updated\">\n                    [% if asset.lastupdated %]\n                        [% if custom.update_text; \n                            custom.update_text; \n                            else; \n                            echo 'Updated:'; end; %]\n                            [%  if cms.system.time('d') - 1 == asset.lastupdated('d') && (asset.lastupdated('m/y') == cms.system.time('m/y')); \n                                echo 'Yesterday';\n                                else if (asset.lastupdated('d') < cms.system.time('d') && asset.lastupdated('m') == cms.system.time('m')) || asset.lastupdated('m') < cms.system.time('m') || asset.lastupdated('y') < cms.system.time('y') ;\n                                asset.lastupdated('F d');\n                            \n                                else; asset.lastupdated('g:i a'); end; %]\n                    [% else if posted_text;\n                        posted_text; asset.starttime('F d');  \n                       else %]\n                        Posted: [% asset.starttime('F d');\n                       end %]\n                    </span>\n                </li>\n                [% end;\n                if cms.site.custom.blox_comments == 'blox' && comment_count == 'true' && asset.no_comments != true; %]\n                    <li>\n                    [%  core_base_library_comment_count('target' : asset, 'mode' : 'standard'); %]\n                    </li>   \n            [%  end;\n                if keyword_tags == 'true' && asset.tags('type':'keyword') %]\n                <li>\n                    [% foreach asset.tags('keyword') as keyword;\n                        if keyword | startswith('#') != 'true';\n                            if icon_in_place != 'true';\n                                icon_in_place = 'true'; %]\n                                                                [% if lazyLoad %]\n                                                                    <img class=\"blox-img-loader\" src=\"[% placeHolder %]\" data-original=\"global/resources/images/icon-05.gif\" alt=\"icon\" />\n                                                                [% else %]\n                                                                    <img src=\"global/resources/images/icon-05.gif\" alt=\"icon\" />\n                                                                [% end %]\n                            [% end %]\n                            <a class=\"tn-tag-link\" href=\"/topic/?q=[% keyword %]&amp;t=&amp;l=25&amp;d=&amp;d1=&amp;d2=&amp;f=html&amp;s=&amp;sd=desc&amp;s=start_time\">[% keyword | titlecase | trim %]</a>\n                            [%- if keyword | iterpos == 2 || keyword | iterlast;\n                                    echo ''; \n                                else; \n                                    echo ','; \n                                end;\n                            end; \n                            if keyword | iterpos == 2; \n                                break; \n                            end;    \n                        end; -%] \n                </li>\n                [% end %]   \n            </ul>\n            [% end %]\n        </div>\n        \n        \n        [% /* foreach this.block.assets as asset */%]\n        [% rAssets = asset.related('type':'article') %]\n            [% if related == 'true' && rAssets | length > 0 %]\n            <div class=\"blox-story-items\">\n                <h4>[%  if custom.related_text; \n                            custom.related_text; \n                        else; \n                            related_text; \n                        end; %]</h4>    \n                    <ul>\n                    [% foreach rAssets as rAsset %]\n                        <li class=\"[% if this.block.custom.service_classes | strbool == true; echo core_base_library_serviceClasses(asset);end; %]\">\n                                                    [% if lazyLoad %]\n                            <img class=\"blox-img-loader tn-icon\" alt=\"[% rAsset.length %] items\" src=\"[% placeHolder %]\" data-original=\"global/resources/images/related/icon_related_[% rAsset.type %].gif\" /><span class=\"uppercase\">[% rAsset.type %]</span>: <a href=\"[% rAsset.url %]\">[% rAsset.title %]</a>\n                                                    [% else %]\n                                                        <img class=\"tn-icon\" alt=\"[% rAsset.length %] items\" src=\"global/resources/images/related/icon_related_[% rAsset.type %].gif\" /><span class=\"uppercase\">[% rAsset.type %]</span>: <a href=\"[% rAsset.url %]\">[% rAsset.title %]</a>\n                                                    [% end %]\n                        </li>\n                        [% if rAsset | iterpos == 1; break; end; %]\n                    [% end %]   \n                    </ul>\n            </div>\n            [% end %]\n        [% /* end  */%]\n[% else %]\n    [% if asset | iterpos == 1 %]\n    <div class=\"blox-sub-title\">\n        <h4>\n            [% if custom.more_link_text %]\n                [% custom.more_link_text | strip_tags | html %]\n            [% else %]\n                More From [% this.block.title | strip_tags | html %]\n            [% end %]\n        </h4>\n    </div>   \n        <div class=\"blox-local-news-column\">\n            <ul class=\"blox-list\">\n    [% end %]   \n            <li>\n                <h3><a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n                    [% asset.title | strip_tags %][% comments = asset.comments; if comments | length > 0 %] <em>([% echo comments | length%])</em>[% end %]</a>\n                </h3>\n            </li>\n    [% if asset | iterlast %]\n            </ul>\n        </div>\n    [% end %]       \n[% end /* end if first condition */ %]\n[% end %]       \n     </div>[% /* end blox-top-story-holder */ %]\n    <div class=\"clear\"></div>\n</div>  [% /* end blox-top-story */ %]\n[% core_base_library_more_stories(this.block) %]\n<div class=\"clear\"></div>\n[% end %]"
    }
  },
  {
    "model": "utl_files.utlfile",
    "pk": 30221,
    "fields": {
      "pkg": "core-asset-index-map",
      "file_path": "block.utl",
      "file_text": "[% /* load base component */\n\nif !cms.component.load('core_base_library'); echo '<!--Failed to load core_base_library component.-->'; end; \n\n/*\n\tName: core asset-index-map\n\t\tVersion: v0-1\n\t\tUpdated: 20100219 ~Paul\n\t\n\tCustom Property Options:\n\t\t------------------------------------------------\n\t\t'show_byline'\n\t\tIf set to true the byline will display. Default\n\t\tis 'false'\n\t\t------------------------------------------------\n\t\t'byline_text'\n\t\tSetting this value will alter the text that \n\t\tprecedes the byline. Setting it to 'false' will\n\t\tturn off the byline_text. Default is 'By'\n\t\t------------------------------------------------\t\t\n\t\t'custom_thumb_off'\n\t\tSetting this value to 'true' in the block admin\n\t\twill turn off the thumbnail images.\n\t\t------------------------------------------------\n\t\t'custom_paragraphs'\n\t\tSetting this numeric property will set the \n\t\tnumber of paragraphs that will be displayed\n\t\tper asset. \n\t\tIf the value is set to 'all' the full asset will\n\t\tbe displayed.\n\t\t------------------------------------------------\n\t\t'collapsible' and 'collapse_link_text'\n\t\tIf set to 'true', 'collapsible' will wrap the \n\t\tbucket in a colapsing div and display a link to \n\t\ttoggle show/hide of that div. \n\t\t'collapse_link'\twill set the text of that link \n\t\t(default text is 'more >>').\n\t\t------------------------------------------------\n\t\t'show details'\n\t\tWhen set to 'true' \n\t\ta sentance describing the section along with\n\t\tthe posted time and comment count will display \n\t\twith the story.\n\t\tex. \"Posted in World on Tuesday, February 23, \n\t\t2010 2:23 pm. Comments(23)\"\n\t\t------------------------------------------------\n\t\t'comment_count'\n\t\tSetting this value to 'true' will toggle the \n\t\tcomment count on. The comment count links to\n\t\tthe asset's commenting area.\n\t\t------------------------------------------------\n\t\t'float_thumb_lead_p'\n\t\tSetting this to true will change the location of \n\t\tthe photo thumb to float to the left of the \n\t\trespective element.\n\t\t------------------------------------------------\n\t\t'lead_off'\n\t\tIf set to 'true' the lead paragraph will NOT be \n\t\tdisplayed in the list.\n\t\t------------------------------------------------\n\t\t'show_updated' and 'update_text'\n\t\tIf 'show_updated' is set to 'true' the time of \n\t\teach story's last update will be displayed. If\n\t\tno update info exists the publish date will \n\t\tdisplay.\n\t\tIf 'update_text' is entered the text will be \n\t\tdisplayed before the date. (if 'Last Updated' is \n\t\tentered, the output will be: \n\t\t'Last Updated: 02/23/2023')\n\t\t------------------------------------------------\n\t\t'photo_caption'\n\t\tSet value to 'true' to toggle the caption to \n\t\tdisplay below the image.\n\t\tDefault is 'false'\n\t\t------------------------------------------------\n\t\t'photo_credit'\n\t\tSet value to true to toggle the photo credit to\n\t\tdisplay below the image.\n\t\tDefault is 'false'\n\t\t------------------------------------------------\n\t\t'photo_credit_text'\n\t\tSets the photo credit text to the provided value.\n\t\tDefault is 'Photo by: '\n\t\tNOTE: dependant upon property 'photo_credit' \n\t\tvalue of 'true'\n\t\t------------------------------------------------\n\t\t'update_location'\n\t\tSetting this value to 'top' 'middle' or 'bottom'\n\t\twill change the location of the 'show_updated'\n\t\tinformation.\n\t\tDefault is 'middle'\n\t\t------------------------------------------------\n\t\t'show_more_link' and 'more_link_text'\n\t\tIf 'show_more_link' is set to 'true', a link to \n\t\tthe article will be displayed below the lead \n\t\tparagraph.\n\t\tIf 'more_link_text' is set the more link will \n\t\tuse the entered text as the link text. The\n\t\tdefault is 'more &raquo;'\n\t\t------------------------------------------------\n\t\t'custom_more_stories'\n\t\tIf 'custom_more_stories' is set to 'true,' a\n\t\tlink will show up at the bottom of the block \n\t\tdisplaying the word 'More' plus the title of the\n\t\tblock (i.e. More Local News). This will link to\n\t\tthe same URL as is set for the title (by default\n\t\tthe name of the block or what is set in custom_url).\n\t\tNote that if custom_url is set to 'none,' this\n\t\toption will not work, even if enabled.\n\t\t------------------------------------------------\n\t\t'custom_url'\n\t\tThis sets a custom URL for both the title link\n\t\tand the 'more stories' link.\n\t\t------------------------------------------------\n\t\t'show_day'\n\t\tThis will display a division by date.  A date div\n\t\tis added each time a new date is found as the \n\t\tblock cycles through assets.\n\t\t------------------------------------------------\n\t\t'show_posted_time'\n\t\tSetting this value to 'true' will toggle the \n\t\ttimestamp (g:i a) on or off. The default is \n\t\t'false' \n\t\t------------------------------------------------\n*/ \n\n/* only begin work if assets are available */\nthis_block = this.block;\ncustom = this_block.custom;\nif this_block.assets | length > 0;\n\n\t\t/* gather site variables */\n\t\tblox_comments = cms.site.custom.blox_comments;\n\t\t\n\t\t/* set default variables */\n\t\tshow_byline = 'false';\n\t\tbyline_text = 'false';\n\t\tchild_icons = 'true';\n\t\tshow_details = 'false';\n\t\t\tcomment_count = 'true';\n\t\tfloat_thumb_lead_p == 'false';\n\t\tphoto_credit = 'false';\n\t\tphoto_credit_text = 'Photo by: ';\n\t\tphoto_caption = 'false';\n\t\tshow_day = 'true';\n\t\tshow_more_link = 'true';\n\t\tshow_updated = 'true';\n\t\tshow_flags = 'true';\n\t\tshow_new_updated = 'true';\n\t\tshow_posted_time = 'false';\n\t\tupdate_location = 'middle';\n\t\tupdate_text = 'Updated';\n\t\trss_query = 'false';\n\t\t\n\t\t/* allow custom override of defaults */\n\t\tif custom.show_byline; byline = custom.show_byline; end;\n\t\tif custom.byline_text; byline_text = custom.byline_text; end;\n\t\tif custom.child_icons; child_icons = custom.child_icons; end;\n\t\tif custom.custom_paragraphs; custom_paragraphs = custom.custom_paragraphs; end;\n\t\tif custom.show_details; show_details = custom.show_details; end;\n\t\t\tif custom.comment_count; comment_count = custom.comment_count; end;\n\t\tif custom.float_thumb_lead_p; float_thumb_lead_p = custom.float_thumb_lead_p; end;\n\t\tif custom.photo_credit; photo_credit = custom.photo_credit; end;\n\t\tif custom.photo_credit_text; photo_credit_text = custom.photo_credit_text; end;\n\t\tif custom.photo_caption; photo_caption = custom.photo_caption; end;\n\t\tif custom.show_day; show_day = custom.show_day; end;\n\t\tif custom.show_more_link; show_more_link = custom.show_more_link; end;\n\t\tif custom.show_updated; show_updated = custom.show_updated; end;\n\t\tif custom.show_flags; show_flags = custom.show_flags; end;\n\t\tif custom.show_posted_time; show_posted_time = custom.show_posted_time; end;\n\t\tif custom.show_new_updated; show_new_updated = custom.show_new_updated; end;\n\t\tif custom.update_location; update_location = custom.update_location; end;\n\t\tif custom.update_text; update_text = custom.update_text; end;\n\t\tif custom.rss_link; rss_link = custom.rss_link; end;\n\t\tif custom.rss_query; rss_query = custom.rss_query; end;\n%]\n\n[% /* initialize show_thumb status */\n\tshow_thumb = true;\t\n\tif (custom.custom_thumb_off == 'true');\n\t\tshow_thumb = false;\n\tend; \n-%] \t\t\n\n[% macro time_updated %]\n[% if asset.lastupdated != null %]\n\t<dd>\n\t<em class=\"item-updated\">\n\t\t[% \tupdate_text; \n\t\t\techo ': '; \n\t\t\tasset.lastupdated('F d, Y - g:i a') %]\n\t</em></dd>\n[% else %]\n    <dd>\n\t<em class=\"item-updated\">\n\t\t[% \t'Posted: '; \n\t\t\tif show_posted_time == 'true';\n\t\t\t\tasset.starttime('F d, Y - g:i a');\n\t\t\telse;\n\t\t\t\tasset.starttime('F d, Y');\n\t\t\tend; %]\n\t</em></dd>\n[% end %]\n[% end /* time updated */ %]\n\n[% macro photo_text %]\n\t[%\tif photo_credit == 'true' && credit %]\n\t\t<div class=\"photo-byline\">\t\n\t\t[%\tphoto_credit_text;\n\t\t\tcredit | html; credit %]\n\t\t</div>\t\n\t[% \tend; /* photo_credit */\n\t\tif photo_caption == 'true' && caption %]\n\t\t<div class=\"photo-cutline\">\n\t\t\t[% caption | html;  caption %]\n\t\t</div>\n\t[% \tend; /* photo caption */\t\t\nend /* photo_text macro */ %]\n\n[% \n\tgridNum = custom.stories;\n\tif gridNum == 2;\n\t\tgrid = 4;\n\telse if gridNum == 3 or gridNum == 4;\n\t\tgrid = 2;\n\tend;\n-%]\n\n[% if custom.collapsible == 'true'; \n\tif custom.collapse_link_text;\n\t\tcollapse_link_text = custom.collapse_link_text; \n\telse;\n\t\tcollapse_link_text = 'more headlines &raquo;';\n\tend;\t\n%]\n\t<div class=\"hidden-div-toggle\">\n\t\t<a href=\"javascript:void(jQuery('#blox-collapse-bucket').toggle(400))\" class=\"more moz-border\">\n          [% collapse_link_text %]\n \t\t</a>\n \t</div><div class=\"clear\"></div>\n\t<div id=\"blox-collapse-bucket\" style=\"display:none;\">\n[% end %]\n\n[% map_pins = [];\n foreach this_block.assets as pin;\n    address = \"\";\n    if pin.address; address = pin.address;\n    else if pin.address1; address = pin.address1 + \" \" + pin.address2; \n    end;\n    \n\tmap_pins[map_pins.length+1] = [ pin.latitude, pin.longitude, address, pin.city, pin.state, pin.postal_code ]; \n end; %]\n\n[% if !cms.component.load(\"core_external_map\"); echo \"<!--Failed to load core_external_map component.-->\"; end; %]\n[% if map_pins|length>0 %]\n\t[% if !map_block_instance; map_block_instance = map_block_instance + 1; else; map_block_instance = 0; end;\n        core_external_map_get_map(map_pins, 'id':this.block.custom.id); \n        %]\n[% end %]\n\n<div class=\"blox-main-index\">\n\t[% if this.block.title %]\n            <div class=\"blox-title\">\n                [% core_base_library_rss_link(tBlock : this.block);\n                core_base_library_title(tBlock : this.block) %]\n            </div>\n            [% core_base_library_sublinks(tBlock : this.block) %]\n        [% end %]\t\n<div class=\"blox-bucket-list\">\n    [% asset_day = 0 /* initialize dating */ %]\n\t[% foreach this_block.assets as asset -%]\n \t[% if show_day == 'true' && asset.starttime && asset.starttime('d') != asset_day;\n\t\tasset_day = asset.starttime('d') %]\n         <div class=\"day-partition\">[% asset.starttime('l m/d/Y') %]</div>\n    [% end %]       \n            <dl class=\"grid_[% grid %] [% if (asset | iterfirst); echo 'alpha'; echo ' first-in-list'; else if (asset | iterlast); echo 'omega'; end; if (asset | itereven); echo' even-list-item'; else; echo' odd-list-item'; end; %]\" id=\"mapMarkerDetails[% asset|iterpos %]\">\n\t[%\tif show_updated == 'true' && update_location == 'top' && asset.lastupdated !=\"null\";\n\t\t\ttime_updated;\n        end %]\t\t\n\t\t[% \tif asset.preview([100,300]);\n\t\t\t\tphoto = asset.preview([100,300]);\n\t\t\t\tif asset.description; caption = asset.content; else; caption = asset.description; end;\n\t\t\t\tcredit = asset.byline;\n\n\t\t\t\tif custom.preview_size;\n\t\t\t\t\tpreview_size = custom.preview_size;\n\t\t\t\t\tphoto = asset.preview([preview_size]);\n\t\t\t\tend;\n\t\t\telse;\t\n\t\t\t\tphoto = asset.items('type':'image')[0].preview([100,300]);\n\t\t\t\tcaption = asset.items('type':'image')[0].description;\n\t\t\t\tcredit = asset.items('type':'image')[0].byline;\t\n\n\t\t\t\tif custom.preview_size;\n\t\t\t\t\tpreview_size = custom.preview_size;\n\t\t\t\t\tphoto = asset.items('type':'image')[0].preview([preview_size]);\n\t\t\t\tend;\n\t\t\tend -%]\n\t\t\t\n                [% if(gridNum != 3) -%]\n                    [% if ((photo and !noPhoto) && show_thumb) && float_thumb_lead_p != 'true' -%]\n                            <dt class=\"bucket-photo map-photo\">\n\t\t\t\t\t\t\t\t<a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n\t\t\t\t\t\t\t\t\t<img alt=\"[% photo.caption | html %]\" src=\"[% photo.url %]\" />\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t[% \tphoto_text %]\n\t\t\t\t\t\t\t</dt>\n                    [% end %]\n                    <dd class=\"bucket-headline map-headline\">\n\t\t\t\t\t\t<a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n\t\t\t\t\t\t\t<span class=\"map-pin-number\">[% asset|iterpos + 1 %].</span>\n\t\t\t\t\t\t\t[% asset.title | strip_tags %]\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t[% if child_icons == 'true'; core_base_library_child; end %]\n\t\t\t \t\t</dd>\n\t\t\t\t\t[% if byline == 'true' && asset.byline %]\n\t\t\t\t\t<dd>\n\t\t\t\t\t\t<p class=\"byline\">\n\t\t\t\t\t\t\t[% if byline_text != 'false'; byline_text; echo ' '; end; asset.byline %]\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</dd>\n\t\t\t\t\t[% end %]\n                    [% \tif show_updated == 'true' && update_location != 'top' && update_location != 'bottom';\n\t\t\t\t\t\ttime_updated;\n                    \tend %]\n                    \n            [% if custom.lead_off != 'true' %]\n\t\t\t<dd>\n\t\t\t[%\tif ((photo and !noPhoto) && show_thumb) && float_thumb_lead_p == 'true' -%]\n\t\t\t<div class=\"bucket-photo float-left\">\n\t\t\t\t<a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n\t\t\t\t\t<img alt=\"[% photo.caption | html %]\" src=\"[% photo.url %]\" width=\"[% photo.width %]\" />\n\t\t\t\t</a>\n\t\t\t\t[% \tphoto_text %]\n\t\t\t </div>\n\t\t\t \n\t\t[%\tend %]\t\t\t\t\n\t\t[% if flags && (show_flags == 'true' || show_new_updated == 'true') %]\n\t\t\n\t\t\t<ul class=\"blox-flags\">\n                [% if show_flags == 'true' %]\n\t\t\t\t<li>[% flag %]</li>[% end %]\n                [% if show_new_updated == 'true' %]\n\t\t\t\t[% core_base_library_new_updated %][% end %]\n       \t\t  </ul>\n\t\t[% end %]\t\n\t\t\t[% if asset.type == 'article' %]\n\t\t\t\t[% if asset.prologue && !custom_paragraphs %]\n\t\t\t  \t\t<p>[% asset.prologue %]</p>\n\t\t\t\t[% else %]\n\t\t\t  \t\t[% if custom_paragraphs %]\n\t\t\t\t\t\t[% if custom_paragraphs == 'all' %]\n\t\t\t\t\t\t\t[% asset.content %]\n\t\t\t\t\t\t[% else %]\n\t\t\t\t\t\t\t[% foreach asset.content as para %]\n\t\t\t\t  \t\t\t\t\t[% para %]\n\t\t\t\t  \t\t\t\t[% if (para | iterpos) >= custom_paragraphs - 1 %]\n\t\t\t\t    \t\t\t\t\t[% break %]\n\t\t\t\t  \t\t\t\t[% end %]\n\t\t\t\t\t\t\t[% end %]\n\t\t\t\t\t\t[% end %]\n\t\t\t  \t\t[% else if custom.custom_truncate %]\n\t\t\t\t\t\t[% foreach asset.content as para %]\n\t\t\t\t\t\t\t[% if (para | length) > custom.custom_truncate %]\n\t\t\t\t\t\t\t\t[% para | strip_tags | html | truncate(custom.custom_truncate, '...') %]\n\t\t\t\t\t\t\t[% else %]\n\t\t\t\t\t\t\t\t[% para | strip_tags | html %]\n\t\t\t\t\t\t\t[% end %]\n\t\t\t\t    \t\t\t[% if (para | iterpos) == 0 %]\n\t\t\t\t      \t\t\t\t[% break %]\n\t\t            \t    \t\t\t[% end %]\n\t\t\t    \t\t[% end %]\n\t\t\t\t\t[% else %]\n\t\t\t\t\t\t[% if custom.build_links == 'true' %]\n\t\t\t\t\t\t\t[% asset.content[0] | autolink %]\n                        [% else %]\n\t\t\t\t\t\t\t[% asset.content[0] %]\n                        [% end %]\n\t\t\t\t\t[% end %]\n\t\t\t\t\n\t\t\t\t[% end %]\n\t\t\t</dd>\n\t\t\t[% else %]\n\t\t\t<dd>\n\t\t\t[%\tif ((photo and !noPhoto) && show_thumb) && float_thumb_lead_p == 'true' -%]\n\t\t\t<div class=\"bucket-photo float-left\">\n\t\t\t\t<a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n\t\t\t\t\t<img alt=\"[% photo.caption | html %]\" src=\"[% photo.url %]\" width=\"[% photo.width %]\" />\n\t\t\t\t</a>\n\t\t\t\t[% \tphoto_text %]\n\t\t\t </div>\n\t\t[%\tend %]\t\t\t\t\n\t\t[% if flags && (show_flags == 'true' || show_new_updated == 'true') %]\n\t\t\t<ul class=\"blox-flags\">\n                [% if show_flags == 'true' && flags %]\n\t\t\t\t<li>[% flag %]</li>[% end %]\n                [% if show_new_updated == 'true' %]\n\t\t\t\t[% core_base_library_new_updated %][% end %]\n           \t</ul>\n\t\t[% end %]\n\t\t\t[% if trunc; asset.description | length > trunc; asset.description | truncate(trunc,'&hellip;'); else; asset.description; end; %] </dd>\n\t\t    [% end %]\n                    [% end %]\n                    [% \tif show_updated == 'true' && update_location == 'bottom' && asset.lastupdated !=\"null\";\n\t\t\t\t\t\ttime_updated;\n                    \tend %]\n\t\t\t\t\t[% if show_details == 'true' %]\n\t\t\t\t\t\t<p class=\"story-more\">\n\t\t\t\t\t\t[% if asset.tags ('section') %]\n\t\t\t\t\t\t  [%- if custom.custom_post_label; \n\t\t\t\t\t\t\tcustom.custom_post_label; \n\t\t\t\t\t\t  else -%]Posted in \n\t\t\t\t\t\t  [%- end %]\n\t\t\t\t\t\t\n\t\t\t\t\t\t[% /* A custom property for posted on label  */ %]\n\t\t\t\t\t\t[% foreach asset.tags('section') as path, tag %]\n\t\t\t\t\t\t[% if tag | iterlast %]\n\t\t\t\t\t\t  <a class=\"tn-tag-link\" href=\"/[% path %]\">[% tag | titlecase | replace('_',' ')  %]</a>\n\t\t\t\t\t\t\t[% else %]\n\t\t\t\t\t\t  <a class=\"tn-tag-link\" href=\"/[% path %]\">[% tag | titlecase | replace('_',' ')  %]</a>, \n\t\t\t\t\t\t\t[% end %] \n\t\t\t\t\t\t[% end %] \n\t\t\t\t\t\ton\n\t\t\t\t\t\t [% end %]\n\t\t\t\t\t\t <em>[% asset.starttime('l, F j, Y g:i a') %]. \n\t\t\t\t\t\t[% if asset.lastupdated %]\n\t\t\t\t\t\t  <span style=\"color: #CC3300;\">Updated: [% asset.lastupdated('g:i a') %].</span>\n\t\t\t\t\t\t[% end %]\n\t\t\t\t\t\t  </em>\n\t\t\t\t\t\t[%\tif this.asset.tags('type':'keyword') %]\n\t\t\t\t\t\t\t[%\tforeach this.asset.tags('keyword') as keyword;\n\t\t\t\t\t\t\t\t\tif keyword | startswith('#') != 'true';\n\t\t\t\t\t\t\t\t\t\tif keyword | iterfirst; %]\n\t\t\t\t\t\t\t\t\t\t | Tags: \n\t\t\t\t\t\t\t\t\t[%\tend %]\n\t\t\t\t\t\t\t\t\t\t<a class=\"tn-tag-link\" href=\"/topic/?q=[% keyword %]&amp;t=&amp;l=25&amp;d=&amp;d1=&amp;d2=&amp;f=html&amp;s=&amp;sd=asc\">\n\t\t\t\t\t\t\t\t\t\t\t[% keyword | titlecase %]\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t[%\tif keyword | iterlast; \n\t\t\t\t\t\t\t\t\t\t\techo ''; \n\t\t\t\t\t\t\t\t\t\telse; \n\t\t\t\t\t\t\t\t\t\t\techo ','; \n\t\t\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t[%\tend; \n\t\t\t\t\t\t\t\tend; \n\t\t\t\t\t\t\tend %]\n\t\t\t\t\t\t[% /* comment count */\n\t\t\t\t\t\tif comment_count == 'true' && this.site.custom.blox_comments != 'none';\n\t\t\t\t\t\t\techo '<em>';\n\t\t\t\t\t\t\t\tcore_base_library_comment_count;\n\t\t\t\t\t\t\techo '</em>';\n\t\t\t\t\t\tend; %]\n\t\t\t  </p>  \n\t\t\t\t\t[% end;\n\t\t\t\t\t\n\t\t\t\t\t/* more link */\t\n\t\t\t\t\t\tif show_more_link == 'true' %]\n\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t<a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n\t\t\t\t\t\t\t[% \tif custom.more_link_text; \n\t\t\t\t\t\t\t\t\tcustom.more_link_text; \n\t\t\t\t\t\t\t\telse; \n\t\t\t\t\t\t\t\t\techo 'more &raquo;'; \n\t\t\t\t\t\t\t\tend;  \n\t\t\t\t\t\t\t%]\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</dd>\n\t\t\t\t\t[% end %]\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t[% else -%]\n\t\t\t\t\t\t[% if show_thumb %]\n\t\t\t\t\t\t<dd><a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\"><img alt=\"[% photo.caption | html %]\" src=\"[% photo.url %]\"  class=\"bucket-photo\" /></a></dd>\n\t\t\t\t\t\t[% end %]\n\t  </dl>\n\t\t\t\t\t\t<dl class=\"grid_[% grid %]\">\n\t\t\t\t\t\t\t<dd class=\"bucket-headline\">\n\t\t\t\t\t\t\t\t<a href=\"[% asset.url %]\" title=\"[% asset.title | html %]\">\n\t\t\t\t\t\t\t\t\t[% asset.title | strip_tags %]\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t[% child %]\n\t\t\t\t\t\t\t</dd>\n\t\t[% if flags && (show_flags == 'true' || show_new_updated == 'true') %]\n\t\t\t<ul class=\"blox-flags\">\n                [% if show_flags == 'true' %]\n\t\t\t\t<li>[% flag %]</li>[% end %]\n                [% if show_new_updated == 'true' %]\n\t\t\t\t<li>[% core_base_library_new_updated %]</li>[% end %]\n           \t\t</ul>\n\t\t[% end %]                    \n                    [% if custom.lead_off != 'true' %]\t\n                        [% if !asset.description %]\n                            <dd class=\"description2\">[% leadP | strip_tags %]</dd>\n                        [% else %]\n                            <dd class=\"description3\">[% asset.description %] </dd>\n                        [% end %]\n                    [% end %]\n                                \n                        \n                    [% gridNum = 4; noPhoto = true; -%]\n                [% end %]\n                <dd><span class=\"clear\"></span></dd>\n            </dl>\n\t[% end %]\n\t<div class=\"clear\"></div>\n\t[% core_base_library_more_stories(this.block) %]\n</div>\n</div> [% /* end main index */\n\tif custom.collapsible == 'true' %]\n</div>\n[% end;\nend %]"
    }
  },
  {
    "model": "utl_files.utlfile",
    "pk": 30235,
    "fields": {
      "pkg": "core-slideshow-presentation-1-15-1-test_block",
      "file_path": "block.utl",
      "file_text": "[%  /*\n\t\t\tcore-slideshow-presentation\n\t\t\t\t\tCreated:\t\t2012.11.20 - mgorman\n\t\t\t\t\tUpdated:\t\t2013.11.04 - mgorman Added basic support when core_base_library_region_width is unavailable.\n\t\t\t\t\tUpdated:\t\t2013.10.04 - mgorman Fixed thumb image carryover issue.\n\t\t\t\t\tUpdated:\t\t2013.10.04 - mgorman Added !photo to first image check in navigation thumbnails.\n\t\t\t\t\tUpdated:\t\t2013.07.14 - mgorman Added link to simulate ability to click on background image.\n\t\t\t\t\tUpdated:\t\t2013.05.20 - mgorman Better Link, Video and Youtube support; headline truncate proprty; byline property\n\t\t\t\t\tUpdated:\t\t2013.04.22 - mgorman\n\t\t\t\t\tUpdated:\t\t2013.04.15 - mgorman\n\t*/ %]\n\t\n\t[% if this.block.assets || this.block.custom.total_ads > 0;\n\t\t/* ======== Components and scripts ======== */\n\t\t\t\tcall cms.component.load('core_base_library');\n\t\t\t\tcall cms.component.load('core_external_jquery');\n\t\t\t\tcall cms.component.load('core_external_jqueryui');\n\t\t\t\tcall cms.component.load('core_yepnope');\n\t\t\t\t/* call cms.component.load('core_internal_jquery_plugins');\n\t\t\t\tcore_internal_jquery_plugins_common;  */\n\t\t\t\tlazyLoad = core_base_library_getCustomProperty('lazy_load', 'boolean', true);\n\t\t\t\tplaceHolder = cms.page.cdn('components/core_external_jquery_plugins/resources/images/place_holder.png');\n\n\t\t/* ======== Pull custom properties ======== */\n\t\t\t\tif this.block.custom.ad_custom_title; ad_custom_title = this.block.custom.ad_custom_title; end;\n\t\t\t\tif this.block.custom.ad_region_id; ad_region_id = this.block.custom.ad_region_id; end;\n\t\t\t\tif this.block.custom.ad_sequence; ad_sequence = this.block.custom.ad_sequence; end;\n\t\t\t\tif this.block.custom.ad_server; ad_server = this.block.custom.ad_server; end;\n\t\t\t\tif this.block.custom.ad_title_type; ad_title_type = this.block.custom.ad_title_type; end;\n\t\t\t\tif this.block.custom.delay_interval; delay_interval = this.block.custom.delay_interval; end;\n\t\t\t\tif this.block.custom.comment_count; comment_count = this.block.custom.comment_count; end;\n\t\t\t\tif this.block.custom.title_truncate; title_truncate = this.block.custom.title_truncate; end;\n\t\t\t\tif this.block.custom.show_byline; show_byline = this.block.custom.show_byline; end;\n\t\t\t\tif this.block.custom.lead_p; lead_p = this.block.custom.lead_p; end;\n\t\t\t\tif this.block.custom.lead_p_truncate; lead_p_truncate = this.block.custom.lead_p_truncate; end;\n\t\t\t\tif this.block.custom.show_related; show_related = this.block.custom.show_related; end;\n\t\t\t\tif this.block.custom.show_new_updated; show_new_updated = this.block.custom.show_new_updated; end;\n\t\t\t\tif this.block.custom.show_keywords; show_keywords = this.block.custom.show_keywords; end;\n\t\t\t\tif this.block.custom.nav_item_height; nav_item_height = this.block.custom.nav_item_height; end;\n\t\t\t\tif this.block.custom.nav_item_location; nav_item_location = this.block.custom.nav_item_location; end;\n\t\t\t\tif this.block.custom.nav_title_truncate; nav_title_truncate = this.block.custom.nav_title_truncate; end;\n\t\t\t\tif this.block.custom.nav_headline_source; nav_headline_source = this.block.custom.nav_headline_source; end;\n\t\t\t\tif this.block.custom.panel_height; panel_height = this.block.custom.panel_height; end;\n\t\t\t\tif this.block.custom.panel_width; panel_width = this.block.custom.panel_width; end;\n\t\t\t\tif this.block.custom.panel_aspect; panel_aspect = this.block.custom.panel_aspect; end;\n\t\t\t\tif this.block.custom.panel_nav_trigger; panel_nav_trigger = this.block.custom.panel_nav_trigger; end;\n\t\t\t\tif this.block.custom.total_ads; total_ads = this.block.custom.total_ads; end;\n\t\t\t\tif this.block.custom.video_player; video_player = this.block.custom.video_player; end;\n\n\t\t/* ======== Variable overrides ======== */\n\t\t\t\tif nav_item_location == \"top\" || nav_item_location == \"bottom\";\n\t\t\t\t\tpanel_width = core_base_library_region_width;\n\t\t\t\t\tnavigation_orientation = 'horizontal';\n\t\t\t\telse if nav_item_location == \"left\" || nav_item_location == \"right\";\n\t\t\t\t\tnavigation_orientation = 'vertical';\n\t\t\t\tend;\n\n\t\t/* ======== Basic block math ======== */\n\t\tslideshow_presentation_instance = slideshow_presentation_instance + 1;\n\t\ttotal_items = total_ads + (this.block.assets | length);\n\t\t\n\t\tif core_base_library_region_width == '';\n\t\t\tif grid_set_blox_grid_system_max == 16;\n                            if grid_set_blox_med_span == 10;\n\t\t\t\tsFullRegionWidth = 580;\n                            else;\n\t\t\t\tsFullRegionWidth = 760;\n                            end;\n\t\t\telse;\n\t\t\t\tsFullRegionWidth = 620;\n\t\t\tend;\n\t\telse;\n\t\t\tsFullRegionWidth = core_base_library_region_width;\n\t\tend;\n\n\t\tthumb_image_size_array = [100,200,300]; \n\t\tthumb_bg_image_size_array = [100,200,300]; \n\t\tsmall_image_size_array = [100,200]; \n\t\tlarge_image_size_array = [300,380,420,540,580]; \n\t\tbg_size_array = [960,820,760,649,580,520,420,300,200,100]; \n\n\t\t\tif ad_sequence != '';\n\t\t\t\tad_slots = ad_sequence | split(\",\"); \n\t\t\tend;\t\n\t\t\n\t\tpanel_item_class = '';\n\t\tpanel_item_style = '';\t\t\n\n\t\tif navigation_orientation == \"vertical\";\n\t\t\t\tfull_panel_width = panel_width;\n\t\t\t\tpanel_height = panel_height - 2; /* border allowance */\n\t\t\t\tif nav_item_location == \"left\"; horiz_adj = 15; else; horiz_adj = 20; end;\n\t\t\t\tpanel_nav_item_height = (panel_height - ( (total_items ) * 10.875))/ total_items;\n\t\t\t\tpanel_nav_item_width = (sFullRegionWidth - panel_width) - horiz_adj;\n\t\t\t\t\n\t\telse;\n\t\t\t\tfull_panel_width = panel_width;\n\t\t\t\tpanel_width = panel_width - 2; /* border allowance */\n\t\t\t\tpanel_nav_item_height = nav_item_height;\n\t\t\t\tpanel_nav_item_width = (sFullRegionWidth  - ( (total_items ) * 4))/ total_items;\n\t\t\t\t/* panel_nav_item_width = panel_nav_item_width | rounddown;  */\n\t\tend; %] \n\t\t\n\n\t\t\n\t\t[% macro build_slideshow_presentation_nav_items;\n\t\t\t/* reset */\n\t\t\tpanel_nav_item_container_class = '';\n\t\t\tpanel_nav_item_container_style = '';\n\n\t\t\t/* building panel_nav_item_container_class */\n\n\t\t\t/* building panel_nav_item_container_style */ %]\n\t\t\t<ul class=\"slideshow-presentation-nav-items [% panel_nav_item_container_class %]\" style=\"[% panel_nav_item_container_style %]\">\n\t\t\t[% \tnav_item_count = 0;\n\t\t\t\tasset_iter = 0;\n\t\t\t\tad_iter = 0;\n\t\t\t\twhile nav_item_count < total_items;\n\t\t\t\t\t/* reset */\n\t\t\t\t\tpanel_nav_item_class = '';\n\t\t\t\t\tpanel_nav_item_style = '';\n\t\t\t\t\tleadin = core_base_library_leadIn('asset':asset)|strip_tags;\n\t\t\t\t\tmax_bg_width = panel_nav_item_width;\n\t\t\t\t\tmax_bg_height = panel_nav_item_height;\n\t\t\t\t\tphoto = '';\n\t\t\t\t\t\n\t\t\t\t\tif total_ads > 0 && ad_iter < total_ads;\n\t\t\t\t\t\tfor ad_slots as ad_slot;\n\n\t\t\t\t\t\t\ttemp_ad_slot = ad_slot - 1;\n\t\t\t\t\t\t\ttemp_ad_instance = ad_iter + 1;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif temp_ad_slot < 0;\n\t\t\t\t\t\t\t\ttemp_ad_slot = 0;\n\t\t\t\t\t\t\telse if temp_ad_slot >= total_items;\n\t\t\t\t\t\t\t\ttemp_ad_slot = (this.block.assets | length) - 1;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tif temp_ad_slot == nav_item_count && ad_iter <= total_ads;  /* > */\n\t\t\t\t\t\t\t\t\tif ad_server == \"OAS\";\n\t\t\t\t\t\t\t\t\t\tsRawNavRegionId = ad_region_id | split(\"|\");\n\t\t\t\t\t\t\t\t\t\taOasNavAdRegions = sRawNavRegionId[0] | splittrim(\",\");\n\t\t\t\t\t\t\t\t\t\tad_nav_item_content = \"<script><!-- OAS_AD('\" + aOasNavAdRegions[ad_iter] + \"'); //--></script>\";\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\telse if ad_title_type == \"custom\";\n\t\t\t\t\t\t\t\t\t\tad_nav_item_content = ad_custom_title;\n\t\t\t\t\t\t\t\t\telse if ad_title_type == \"internal\";\n\t\t\t\t\t\t\t\t\t\tad_nav_item_content = \"Advertisement\";\n\t\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\t\tad_nav_item_content = \"Advertisement\";\n\t\t\t\t\t\t\t\t\tend; \n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t/* building panel_nav_item_class */\n\t\t\t\t\t\t\t\t\tlist_position_class = '';\n\t\t\t\t\t\t\t\t\tif nav_item_count == 0;\n\t\t\t\t\t\t\t\t\t\tlist_position_class =  \"first-in-list\";\n\t\t\t\t\t\t\t\t\telse if nav_item_count == total_items - 1;\n\t\t\t\t\t\t\t\t\t\tlist_position_class = \"last-in-list\";\n\t\t\t\t\t\t\t\t\tend;\n\n\n\t\t\t\t\t\t\t\t\tpanel_nav_item_classes = [\n\t\t\t\t\t\t\t\t\t\t\"slideshow-presentation-nav-item\",\n\t\t\t\t\t\t\t\t\t\t\"blox-transparency\",\n\t\t\t\t\t\t\t\t\t\t\"ad-nav-item\",\n\t\t\t\t\t\t\t\t\t\tlist_position_class\n\t\t\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\t\t/* building panel_nav_item_style */\n\n\t\t\t\t\t\t\t\t\tcursor_style = '';\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif panel_nav_trigger == \"hover\";\n\t\t\t\t\t\t\t\t\t\tcursor_style = ' cursor:pointer; ';\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tpanel_relative_style == '';\n\t\t\t\t\t\t\t\t\tif navigation_orientation == \"horizontal\";\n\t\t\t\t\t\t\t\t\t\tpanel_relative_style = \"position: relative;\";\n\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tpanel_nav_item_styles = [\n\t\t\t\t\t\t\t\t\t\t\"height: \" + panel_nav_item_height + \"px;\",\n\t\t\t\t\t\t\t\t\t\t\"width: \" + panel_nav_item_width + \"px;\",\n\t\t\t\t\t\t\t\t\t\tcursor_style,\n\t\t\t\t\t\t\t\t\t\tpanel_relative_style,\n\t\t\t\t\t\t\t\t\t\t\"ad\"\n\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t%]\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<li id=\"slideshow-presentation-[% slideshow_presentation_instance %]-nav-[% nav_item_count %]\" class=\"[% panel_nav_item_classes | join(' '); %]\" style=\"[% panel_nav_item_styles | join(' '); %]\" data-slideshow-presentation-ad=\"[% ad_slots[ad_iter] %]\">\n\t\t\t\t\t\t\t\t\t\t[% if ad_server != \"OAS\" %]\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"\" class=\"link\"><span class=\"headline\">\n\t\t\t\t\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t\t\t\t\t\t[% ad_nav_item_content %]\n\t\t\t\t\t\t\t\t\t\t[% if ad_server != \"OAS\" %]\n\t\t\t\t\t\t\t\t\t\t\t</span></a>\n\t\t\t\t\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t[% ad_iter = ad_iter + 1;\n\t\t\t\t\t\t\t\tnav_item_count = nav_item_count + 1;\t\n\t\t\t\t\t\t\tend; \t/* ad builder loop */\n\t\t\t\t\t\tend;\t /* ad_slot loop */\n\t\t\t\t\tend; \t/* master ad loop */\n\t\t\t\t\tif asset_iter < (this.block.assets | length); \t/* > */\n\t\t\t\t\t\n\t\t\t\t\tpanel_nav_item_class = '';\n\t\t\t\t\tpanel_nav_item_style = '';\n\t\t\t\t\tleadin = core_base_library_leadIn('asset':asset)|strip_tags;\n\t\t\t\t\tmax_bg_width = panel_nav_item_width;\n\t\t\t\t\tmax_bg_height = panel_nav_item_height;\n\t\t\t\t\tphoto = '';\n\t\t\t\t\tasset_href = '';\n\t\t\t\t\t\tasset = this.block.assets[asset_iter];\n\t\t\t\t\t\tif navigation_orientation == \"horizontal\";\n\t\t\t\t\t\t\tfor thumb_bg_image_size_array as image_thumb;\n\t\t\t\t\t\t\t\tif !photo && image_thumb > panel_nav_item_width; \n\t\t\t\t\t\t\t\t\tphoto = asset.preview(image_thumb);\n\t\t\t\t\t\t\t\t\tif !photo;\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif asset.items('relationship':'child')[0].preview(image_thumb);\n\t\t\t\t\t\t\t\t\t\t\tphoto = asset.items('relationship':'child')[0].preview(image_thumb);\n\t\t\t\t\t\t\t\t\t\t\tif photo; break; end;\n\t\t\t\t\t\t\t\t\t\telse if asset.type == 'business' && tryLogo;\n\t\t\t\t\t\t\t\t\t\t\tphoto = asset.logo;\n\t\t\t\t\t\t\t\t\t\t\tif photo; break; end;\n\t\t\t\t\t\t\t\t\t\telse if asset.type == 'image';\n\t\t\t\t\t\t\t\t\t\t\tphoto = asset.preview(image_thumb);\n\t\t\t\t\t\t\t\t\t\t\tif photo; break; end;\n\t\t\t\t\t\t\t\t\t\telse if asset.type == 'edition' || asset.type == 'collection';\n\t\t\t\t\t\t\t\t\t\t\tfor thumb_bg_image_size_array as image_thumb_sub;    \n\t\t\t\t\t\t\t\t\t\t\t\tif asset.items('relationship':'child')[0].preview(image_thumb_sub) < max_bg_width; \t/* > */\n\t\t\t\t\t\t\t\t\t\t\t\t\tif asset.preview(image_thumb_sub);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tphoto = asset.items('relationship':'child')[0].preview(image_thumb_sub);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif photo;break;end;\n\t\t\t\t\t\t\t\t\t\t\t\t\tend; /* if */\n\t\t\t\t\t\t\t\t\t\t\t\tend; /* if */\n\t\t\t\t\t\t\t\t\t\t\tend; /* for */\n\t\t\t\t\t\t\t\t\t\tend;  /* if */  \n\t\t\t\t\t\t\t\t\tend; /* if !photo */\n\t\t\t\t\t\t\t\tend; /* if image_thumb > panel_nav_item_width; */\t\t\t\t\t\n\t\t\t\t\t\t\tend; /* for */\n\t\t\t\t\t\tend; /* if nav_orientation */\n\t\t\t\t\t\techo '</script>';\n\t\t\t\t\t\t\n\t\t\t\t\t\t/*\tThe absolute, last-ditch effort to get any type of thumbnail */\n\t\t\t\t\t\tif !photo.url;\n\t\t\t\t\t\t\tif navigation_orientation == \"horizontal\" && panel_nav_item_width > 100;\n\t\t\t\t\t\t\t\t\timage_thumb = 300;\n\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\timage_thumb = 100;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tphoto =  asset.items('relationship':'child')[0].preview(image_thumb);\n\t\t\t\t\t\tend;\n\n\n\t\t\t\t\t\tif photo && navigation_orientation == \"horizontal\"; \n\t\t\t\t\t\t\tif photo.url | startswith(\"/\");\n\t\t\t\t\t\t\t\tphoto.url = \"http:/\" + photo.url;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tpanel_nav_bg_style = \"background:url(\" + photo.url + \") no-repeat center center #343434;\";\n\t\t\t\t\t\telse if !photo.url;\n\t\t\t\t\t\t\tpanel_nav_bg_style = '';\n\t\t\t\t\t\tend;\n\n\t\t\t\t\t\t/* building panel_nav_item_class */\n\t\t\t\t\t\t\tlist_position_class = '';\n\t\t\t\t\t\t\tif nav_item_count == 0;\n\t\t\t\t\t\t\t\tlist_position_class =  \"first-in-list\";\n\t\t\t\t\t\t\telse if nav_item_count == total_items - 1;\n\t\t\t\t\t\t\t\tlist_position_class = \"last-in-list\";\n\t\t\t\t\t\t\tend;\n\n\t\t\t\t\t\t\tpanel_nav_item_classes = [\n\t\t\t\t\t\t\t\t\"slideshow-presentation-nav-item\",\n\t\t\t\t\t\t\t\t\"blox-ie-no-filter\",\n\t\t\t\t\t\t\t\t\"blox-transparency\",\n\t\t\t\t\t\t\t\tlist_position_class,\n\t\t\t\t\t\t\t\tasset.type\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\n\t\t\t\t\t\t/* building panel_nav_item_style */\n\n\t\t\t\t\t\t\tcursor_style = '';\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif panel_nav_trigger == \"hover\";\n\t\t\t\t\t\t\t\tcursor_style = 'cursor:pointer;';\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpanel_relative_style == '';\n\t\t\t\t\t\t\tif navigation_orientation == \"horizontal\";\n\t\t\t\t\t\t\t\tpanel_relative_style = \"position: relative;\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpanel_nav_item_styles = [\n\t\t\t\t\t\t\t\tpanel_nav_bg_style,\n\t\t\t\t\t\t\t\t\"height: \" + panel_nav_item_height + \"px;\",\n\t\t\t\t\t\t\t\t\"width: \" + panel_nav_item_width + \"px;\",\n\t\t\t\t\t\t\t\tcursor_style,\n\t\t\t\t\t\t\t\tpanel_relative_style\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t/* build nav title */\n\t\t\t\t\t\t\tif nav_headline_source == \"headline_only\";\n\t\t\t\t\t\t\t\tif nav_title_truncate > 0;\n\t\t\t\t\t\t\t\t\tnav_title_content = asset.title | truncate(nav_title_truncate, \"...\");\n\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\tnav_title_content = asset.title;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\tif asset.hammer;\n\t\t\t\t\t\t\t\t\tif nav_title_truncate > 0; nav_title_content = asset.hammer | truncate(nav_title_truncate, \"...\"); else; nav_title_content = asset.hammer;  end;\n\t\t\t\t\t\t\t\telse if asset.kicker;\n\t\t\t\t\t\t\t\t\tif nav_title_truncate > 0; nav_title_content = asset.kicker | truncate(nav_title_truncate, \"...\"); else; nav_title_content = asset.kicker;  end;\t\t\t\t\n\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\tif nav_title_truncate > 0; nav_title_content = asset.title | truncate(nav_title_truncate, \"...\"); else; nav_title_content = asset.title;  end;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif asset.type == \"link\";\n\t\t\t\t\t\t\t\tif asset.url | contains(\"http\");\n\t\t\t\t\t\t\t\t\tasset_href = asset.url;\n\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\tasset_href = \"http://\" + asset.url;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\tasset_href = \"http://\" + cms.system.domain + asset.url;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t/* The onclick attribute was left as an inline conditional. Quotes, apostrophes, conflict... oh my. */\n\t\t\t\t\t\t%]\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<li id=\"slideshow-presentation-[% slideshow_presentation_instance %]-nav-[% nav_item_count %]\" class=\"[% panel_nav_item_classes | join(' ') %]\" style=\"[% panel_nav_item_styles %]\" [% if panel_nav_trigger == \"hover\" %]onclick=\"window.location = '[% asset_href %]'\"[% end %]>\n\t\t\t\t\t\t\t\t[% if navigation_orientation == \"vertical\";\n\t\t\t\t\t\t\t\t\tphoto = core_base_library_assetthumb('asset':asset,'sizearray':thumb_image_size_array);\n\t\t\t\t\t\t\t\t\tif photo.url %]\n\t\t\t\t\t\t\t\t\t\t<a href=\"[% asset_href %]\" title=\"[% asset.title %]\"  [% if panel_nav_trigger == \"hover\" %]onclick=\"window.location = '[% asset_href %]'\"[% end; %]>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"thumb\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t[% if lazyLoad;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\techo '<img class=\"blox-img-loader\" src=\"'+(placeHolder)+'\" data-original=\"'+(photo.url)+'\" width=\"'+(photo.width)+'\" />';\n\t\t\t\t\t\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\techo '<img src=\"'+(photo.url)+'\" width=\"'+(photo.width)+'\" />';\n\t\t\t\t\t\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t[% end;\n\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<a href=\"[% asset_href %]\" title=\"[% asset.title %]\" class=\"link\">\n\t\t\t\t\t\t\t\t\t<span class=\"headline\">[% nav_title_content %]</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t[%\tnav_item_count = nav_item_count + 1;\n\t\t\t\t\t\t\t\tasset_iter = asset_iter + 1;\n\t\t\t\t\tend; /* asset_iter */\n\t\t\t\tend; /* master while */ %]\t\n\t\t\t</ul>\n\t\t[% end; %]\n\n\n\n\t[% /* ================================  Main Block building ================================    */\n\n\t\t\t/* build container class string */\n\t\t\tcontainer_class_string = container_class_string  + \" \" + nav_item_location + \" \";\n\t\t\tif navigation_orientation == \"vertical\"; \n\t\t\t\t\tcontainer_class_string = container_class_string  + \" vertical \";\n\t\t\telse;\n\t\t\t\t\tcontainer_class_string = container_class_string + \" horizontal \";\n\t\t\tend; %]\n\t\t\t\n\t\t[% /* block title (Temporary until macros above are setup for new properties) */\n\t\tif this.block.title; \n\t\t\techo '<div class=\"blox-title\">';\n\t\t\t\techo '<h3>';\n\t\t\t\tif this.block.title_url;\n\t\t\t\t\techo '<a href=\"'+(core_base_library_cleanUrl('linkUrl':this.block.title_url))+'\"';\n\t\t\t\t\tif this.block.title_url_new_window;\n\t\t\t\t\t\techo ' target=\"_blank\"';\n\t\t\t\t\tend;\n\t\t\t\t\techo '>';\n\t\t\t\tend;\n\t\t\t\t\n\t\t\t\techo this.block.title| html| strip_tags;\n\t\t\t\t\n\t\t\t\tif this.block.title_url;\n\t\t\t\t\techo '</a>';\n\t\t\t\tend;\n\t\t\t\t\n\t\t\t\techo '</h3>';\n\t\t\techo '</div>';\n\t\tend;\n\t\t\n\t\t/* block links */\t\n\t\tif this.block.links;\n\t\t\techo '<p class=\"blox-zebra-nav\">';\n\t\t\t/* the system properties for url and text are swapped. HA. so we reverse them causing future issues... */\n\t\t\t\tforeach this.block.links as aLink;\n\t\t\t\t\techo '<a href=\"'+(core_base_library_cleanUrl('linkUrl':aLink.url))+'\">';\n\t\t\t\t\t\techo (aLink.text|html|strip_tags);\n\t\t\t\t\techo '</a>';\n\t\t\t\tend;\n\t\t\techo '</p>';\n\t\tend; %]\n\t\t\t\n\t\t\n\t\t<div id=\"slideshow-presentation-[% slideshow_presentation_instance %]\" class=\"slideshow-presentation [% container_class_string %]\">\n\n\t\t\t[% if nav_item_location == 'left' || nav_item_location == 'top';\n\t\t\t\tbuild_slideshow_presentation_nav_items;\n\t\t\tend;\n\t\t\tif nav_item_location == 'top';\n\t\t\t\techo \"<div class='clear'></div>\";\n\t\t\tend;\n\t\t\t\n\t\t\t/* reset */\n\t\t\tad_iter = 0;\n\t\t\tpanel_container_class = '';\n\t\t\tpanel_container_style = '';\n\n\t\t\t/* building panel_item_class */\n\n\t\t\t/* building panel_item_style */\n\t\t\tpanel_container_style = panel_container_style + \" width: \" + panel_width + \"px; \";\n\t\t\tpanel_container_style = panel_container_style + \" height: \" + panel_height + \"px; \"; %]\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\tvar adNavTitles = new Array();\n\t\t\t\tvar adClickURLs = new Array();\n\t\t\t\tvar adNavBGs = new Array();\n\t\t\t</script>\n\t\t\t<ul class=\"slideshow-presentation-panel-items\" class=\"slideshow-presentation-panel-items [%- panel_container_class -%]\"  style=\"[%- panel_container_style -%]\">\n\t\t\t[%\tpanel_item_count = 0;\n\t\t\t\tasset_iter = 0;\n\t\t\t\tad_iter = 0;\n\t\t\t\twhile panel_item_count < total_items;\n\t\t\t\t\tphoto = '';\n\t\t\t\t\tpanel_item_class = '';\n\t\t\t\t\tpanel_item_style = '';\t\t\n\t\t\t\t\timage_item_class = '';\n\t\t\t\t\timage_item_style = '';\n\t\t\t\t\tleadin = '';\n\t\t\t\t\n\t\t\t\t\tif total_ads > 0  && ad_iter < total_ads;\n\t\t\t\t\t\tfor ad_slots as ad_slot;\n\t\t\t\t\t\t\ttemp_ad_slot = ad_slot - 1;\n\t\t\t\t\t\t\ttemp_ad_instance = ad_iter + 1;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif temp_ad_slot < 0;\n\t\t\t\t\t\t\t\ttemp_ad_slot = 0;\n\t\t\t\t\t\t\telse if temp_ad_slot >= total_items;\n\t\t\t\t\t\t\t\ttemp_ad_slot = (this.block.assets) - 1;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif temp_ad_slot == panel_item_count  && ad_iter < total_ads;\n\t\t\t\t\t\t\t\t/* building panel_item_class */\n\t\t\t\t\t\t\t\tpanel_item_class = panel_item_class + \" slideshow-presentation-panel-item \";\n\t\t\t\t\t\t\t\tpanel_item_class = panel_item_class + \" ad-panel-item \";\n\t\t\t\t\t\t\t\tpanel_item_class = panel_item_class + \" blox-transparency \";\n\t\t\t\t\t\t\t\tif panel_item_count == 0;\n\t\t\t\t\t\t\t\t\tpanel_item_class = panel_item_class + \" first-in-list \";\n\t\t\t\t\t\t\t\telse if panel_item_class == total_items - 1;\n\t\t\t\t\t\t\t\t\tpanel_item_count = panel_item_class + \" last-in-list \";\n\t\t\t\t\t\t\t\tend;\n\n\t\t\t\t\t\t\t\t/* building panel_item_style */\n\t\t\t\t\t\t\t\t/* panel_item_style = panel_item_style  + \" width: \" + panel_width + \"px; \";\n\t\t\t\t\t\t\t\tpanel_item_style = panel_item_style  + \" height: \" + panel_height + \"px; \"; */\n\t\t\t\t\t\t\t\tpanel_item_style = panel_item_style + \" display:none; \";\n\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t/* building image_item_class */\n\n\t\t\t\t\t\t\t\t/* building image_item_style */ %]\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<li id=\"slideshow-presentation-[% slideshow_presentation_instance %]-item-[% panel_item_count %]\" class=\"[% panel_item_class %]\" style=\"[% panel_item_style %]\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t[% if cms.system.venue != \"admin\"; \n\t\t\t\t\t\t\t\t\t\t\tif ad_server == \"zedo\";\n\t\t\t\t\t\t\t\t\t\t\t\tregion_id = '';\n\t\t\t\t\t\t\t\t\t\t\t\tif ad_region_id | contains(\",\");\n\t\t\t\t\t\t\t\t\t\t\t\t\tad_region_id_array = ad_region_id | split(\",\");\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor ad_region_id_array as ad_region;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ad_region | iterpos == ad_iter;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tregion_id = ad_region;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\t\t\t\t\tregion_id = ad_region_id;\n\t\t\t\t\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t\t\t\t\t<iframe src=\"http://c5.zedo.com/jsc/c5/ff2.html?n=1466;c=152/2/1;s=1;d=[% region_id %];w=[% panel_width %];h=[% panel_height %]\" frameborder=0 marginheight=0 marginwidth=0 scrolling=\"no\" allowTransparency=\"true\" width=[% panel_width %] height=[% panel_height %]></iframe>\n\t\t\t\t\t\t\t\t\t\t\t[% else if ad_server == \"OAS\";\n\t\t\t\t\t\t\t\t\t\t\t\tsRawNavRegionId = ad_region_id | split(\"|\");\n\t\t\t\t\t\t\t\t\t\t\t\taOasNavAdRegions = sRawNavRegionId[1] | splittrim(\",\"); %]\n\t\t\t\t\t\t\t\t\t\t\t\t<script>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- OAS_AD([% aOasNavAdRegions[ad_iter] -%]); //-->\n\t\t\t\t\t\t\t\t\t\t\t\t</script>\n\t\t\t\t\t\t\t\t\t\t[% else %] [% /* fixed? by garrett */ %]\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Ad Manager javascript code for position  [% ad_region_id %][% temp_ad_instance %]  -->\n\t\t\t\t\t\t\t\t\t\t\t\t<script type='text/javascript' src='http://[% cms.system.domain %]/content/tncms/ads/[% ad_region_id -%]/[% ad_region_id -%][% temp_ad_instance -%].js'></script>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t[% /* If the tab_trigger is set to \"hover\" and the site is using blox ads, then this will pull the URL from the TNCMS_Ads array and attach it to the tab, creating an onclick event. */  %]\n\t\t\t\t\t\t\t\t\t\t\t\t<script type='text/javascript'>\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor(var aAd in TNCMS_Ads) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t[% nav_tab_container = \"slideshow-presentation-\" + slideshow_presentation_instance + \"-nav-\" + panel_item_count -%]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t[% /* Cause ad nav item to link */\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif panel_nav_trigger == 'hover' %]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar sTabClickURI = TNCMS_Ads[aAd]['clickuri']; \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar sOnClickAction = sTabClickURI;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tadClickURLs[[% ad_iter %]] = sOnClickAction;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t[% end;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/* set nav_item_title */ \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ad_title_type == \"internal\" %]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tadNavTitles[[% ad_iter %]] = TNCMS_Ads[aAd]['title'];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t[% end;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif navigation_orientation == \"horizontal\"; %]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(TNCMS_Ads[aAd]['type'] == \"image\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tadNavBGs[[% ad_iter %]] = TNCMS_Ads[aAd]['uri'];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t</script>\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Ad Manager call to display ads for position [% region %][% ad_instance %]  -->\n\t\t\t\t\t\t\t\t\t\t\t\t<script language='javascript'>oTNCMS_Ad.show();</script>\n\t\t\t\t\t\t\t\t\t\t\t[% end;\n\t\t\t\t\t\t\t\t\t\telse; %]\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t[% end;%]\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t[%\tpanel_item_count = panel_item_count + 1;\n\t\t\t\t\t\t\t\tad_iter = ad_iter + 1;\n\t\t\t\t\t\t\tend; /* ad builder */\n\t\t\t\t\t\tend; /* ad_slot loop */\n\t\t\t\t\tend;   /* master ad loop */\n\t\t\t\t\t\t\t\n\t\t\t\t\tif asset_iter < (this.block.assets | length);\n\t\t\t\t\t\tphoto = '';\n\t\t\t\t\t\tpanel_item_class = '';\n\t\t\t\t\t\tpanel_item_style = '';\t\t\n\t\t\t\t\t\timage_item_class = '';\n\t\t\t\t\t\timage_item_style = '';\n\t\t\t\t\t\tleadin = '';\n\t\t\t\t\t\tis_video_type = false;\n\n\t\t\t\t\t\tasset = this.block.assets[asset_iter];\n\n\t\t\t\t\t\tif lead_p == true;\n\t\t\t\t\t\t\tleadin = core_base_library_leadIn('asset':asset)|strip_tags;\n\t\t\t\t\t\tend;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif navigation_orientation == \"horizontal\";\n\t\t\t\t\t\t\tcomparative_width = core_base_library_region_width;\n\t\t\t\t\t\telse;\n\t\t\t\t\t\t\tcomparative_width = panel_width;\n\t\t\t\t\t\tend;\n\t\t\t\t\t\tif comparative_width <= 420;\n\t\t\t\t\t\t\tblock_size = \"small\";\n\t\t\t\t\t\t\timage_size_array = small_image_size_array;\n\t\t\t\t\t\telse;\n\t\t\t\t\t\t\tblock_size = \"large\";\n\t\t\t\t\t\t\timage_size_array = large_image_size_array;\n\t\t\t\t\t\tend;\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\tif asset.type == \"article\" || \n\t\t\t\t\t\tasset.type == \"link\" || \n\t\t\t\t\t\tasset.type == \"pdf\" || \n\t\t\t\t\t\tasset.type ==  \"collection\" || \n\t\t\t\t\t\tasset.type == \"edition\";\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tchild_image = asset.items('relationship':'child')[0];\n\t\t\t\t\t\t\tif child_image.preview(full_panel_width);\n\t\t\t\t\t\t\t\tphoto = child_image.preview(full_panel_width);\n\t\t\t\t\t\t\t\timage_type = \"background\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tif !photo && child_image.width > panel_width && child_image.height > panel_height;\n\t\t\t\t\t\t\t\timage_type = \"background\";\n\t\t\t\t\t\t\t\tphoto = child_image;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tif !photo;\n\t\t\t\t\t\t\t\tphoto = core_base_library_assetthumb('asset':asset,'sizearray':image_size_array);\n\t\t\t\t\t\t\t\tif photo; \n\t\t\t\t\t\t\t\t\timage_type = \"preview\";\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\telse if asset.type == \"youtube\" || asset.type == \"video\" || asset.type == \"vmix\" || asset.type == \"syndicaster\";\n\t\t\t\t\t\t\tif video_player | strbool == true;\n\t\t\t\t\t\t\t\tis_video_type = true;\n\t\t\t\t\t\t\t\tvideo_preview_img == false;\n\t\t\t\t\t\t\t\timage_type = \"none\";\n\t\t\t\t\t\t\telse; \n\t\t\t\t\t\t\t\tchild_image = asset.items('relationship':'child')[0];\n\t\t\t\t\t\t\t\tif child_image.preview(full_panel_width);\n\t\t\t\t\t\t\t\t\tphoto = child_image.preview(full_panel_width);\n\t\t\t\t\t\t\t\t\tvideo_preview_img == true;\n\t\t\t\t\t\t\t\t\timage_type = \"background\";\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\tif !photo && child_image.width > panel_width && child_image.height > panel_height;\n\t\t\t\t\t\t\t\t\tvideo_preview_img == true;\n\t\t\t\t\t\t\t\t\timage_type = \"background\";\n\t\t\t\t\t\t\t\t\tphoto = child_image;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\tif !photo;\n\t\t\t\t\t\t\t\t\tphoto = core_base_library_assetthumb('asset':asset,'sizearray':image_size_array);\n\t\t\t\t\t\t\t\t\tif photo; \n\t\t\t\t\t\t\t\t\t\tvideo_preview_img == true;\n\t\t\t\t\t\t\t\t\t\timage_type = \"preview\";\n\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\n\t\t\t\t\t\telse if asset.type == \"image\";\n\t\t\t\t\t\t\tif asset.preview(full_panel_width);\n\t\t\t\t\t\t\t\tphoto = asset.preview(full_panel_width);\n\t\t\t\t\t\t\t\timage_type = \"background\";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tif !photo && asset.width > panel_width && asset.height > panel_height;\n\t\t\t\t\t\t\t\timage_type = \"background\";\n\t\t\t\t\t\t\t\tphoto = asset;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tif !photo;\n\t\t\t\t\t\t\t\tphoto = core_base_library_assetthumb('asset':asset,'sizearray':image_size_array);\n\t\t\t\t\t\t\t\tif photo; \n\t\t\t\t\t\t\t\t\timage_type = \"preview\";\n\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\n\t\t\t\t\t\tend;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif image_type == \"preview\";\n\t\t\t\t\t\t\tif photo.height >= (panel_height - (panel_height * 0.04));\n\t\t\t\t\t\t\t\timage_item_style = image_item_style + \" height:96% \";\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\tend;\n\n\t\t\t\t\t\t/* building panel_item_class */\n\t\t\t\t\t\tpanel_item_class = panel_item_class + \" slideshow-presentation-panel-item \";\n\t\t\t\t\t\tpanel_item_class = panel_item_class + \" blox-ie-no-filter \";\n\t\t\t\t\t\tpanel_item_class = panel_item_class + \" blox-transparency \";\n\t\t\t\t\t\tpanel_item_class = panel_item_class + \" \" + asset.type + \" \";\n\t\t\t\t\t\tpanel_item_class = panel_item_class + \" \" + image_type + \" \";\n\t\t\t\t\t\tif panel_item_class == 0;\n\t\t\t\t\t\t\tpanel_item_class = panel_item_class + \" first-in-list \";\n\t\t\t\t\t\telse if panel_item_class == total_items - 1;\n\t\t\t\t\t\t\tpanel_item_class = panel_item_class + \" last-in-list \";\n\t\t\t\t\t\tend;\n\n\t\t\t\t\t\t/* building panel_item_style */\n\t\t\t\t\t\tif image_type == \"background\" && photo.url != \"\";\n\t\t\t\t\t\t\tif photo.url | startswith(\"/\");\n\t\t\t\t\t\t\t\tphoto.url = \"http:/\" + photo.url;\n\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\tpanel_item_style = panel_item_style + \" background:url(\" + photo.resource_url + \") no-repeat center center transparent; \";\n\t\t\t\t\t\tend;\n\t\t\t\t\t\t/* panel_item_style = panel_item_style  + \" width: \" + panel_width + \"px; \";\n\t\t\t\t\t\tpanel_item_style = panel_item_style  + \" height: \" + panel_height + \"px; \"; */\n\t\t\t\t\t\tpanel_item_style = panel_item_style + \" display:none; \";\n\n\t\t\t\t\t\t\n\t\t\t\t\t\t/* building image_item_class */\n\t\t\t\t\t\timage_item_class = image_item_class + \" \" + image_type + \" \";\n\t\t\t\t\t\timage_item_class = image_item_class + \" \" + photo.orientation + \" \";\n\t\t\t\t\t\timage_item_class = image_item_class + \" \" + photo.comp_size + \" \";\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\ttitle_content = asset.title;\n\t\t\t\t\t\tif title_truncate > 0; \n\t\t\t\t\t\t\ttitle_content = title_content | truncate(title_truncate, \"...\");\n\t\t\t\t\t\tend;\n\n\t\t\t\t\t\t/* building image_item_style */ %]\n\t\t\t\t\t\t<li  id=\"slideshow-presentation-[% slideshow_presentation_instance %]-item-[% panel_item_count %]\" class=\"[% panel_item_class %]\" style=\"[% panel_item_style %]\">\n\t\t\t\t\t\t\t[% if (image_type == \"background\"); %]\n\t\t\t\t\t\t\t\t<a href=\"[% asset.url %]\" class=\"background-image-link\"></a>\n\t\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t\t[% if (image_type == \"preview\") && block_size == \"large\"; %]\n\t\t\t\t\t\t\t\t<div class=\"panel-photo-container\" style=\"[% image_item_style %]\">\n\t\t\t\t\t\t\t\t\t<img src=\"[% photo.url %]\" alt=\"[% photo.title %]\" class=\"[% photo_item_class %]\" style=\"[% photo_item_style %]\" />\n\t\t\t\t\t\t\t\t\t[% if show_byline && photo.byline %]<div class=\"photo-byline\">[% photo.byline %]</div>[% end %]\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t\t[% if image_type == \"background\" && photo.byline && show_byline %]\n\t\t\t\t\t\t\t\t<p class=\"photo-byline\">[% photo.byline %]</p>\n\t\t\t\t\t\t\t[% end %]\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t[% if is_video_type == true && video_player | strbool == true; \n\t\t\t\t\t\t\t\tplayer_id = 'slideshow_presentation_' + slideshow_presentation_instance + '_item_' + panel_item_count + \"_player\";\n\t\t\t\t\t\t\t\tif !cms.component.load('core_video_player');echo '<!--Failed to load core_video_player component.-->'; end;\n\t\t\t\t\t\t\t\tcore_video_player('assets':[asset],'style':'hd','player_width':panel_width,'player_height':panel_height,'id':player_id,'mode':'embedded');\n\t\t\t\t\t\t\tend %]\n\n\t\t\t\t\t\t\t<div class=\"panel-content-container\" class=\"blox-transparency\">\n\t\t\t\t\t\t\t\t<h3><a href=\"[% asset.url %]\">[% title_content | strip_tags | html %]</a></h3>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t[% if image_type == \"preview\" && block_size == \"small\"; %]\n\t\t\t\t\t\t\t\t\t<div class=\"panel-photo-container\" style=\"[% image_item_style %]\">\n\t\t\t\t\t\t\t\t\t\t<img src=\"[% photo.url %]\" alt=\"[% photo.title %]\" class=\"[% photo_item_class %]\" style=\"[% photo_item_style %]\" />\n\t\t\t\t\t\t\t\t\t\t[% if  photo.byline && show_byline %] <div class=\"photo-byline\">[% photo.byline %]</div>[% end %]\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t\t\t<div class=\"panel-content\">\n\t\t\t\t\t\t\t\t\t[% if show_byline == true && asset.byline; \n\t\t\t\t\t\t\t\t\t\t\techo '<p class=\"byline\">' + asset.byline + '</p>';\n\t\t\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t\t[% if lead_p == true; \n\t\t\t\t\t\t\t\t\t\t\tif lead_p_truncate > 0;\n\t\t\t\t\t\t\t\t\t\t\t\tleadin = leadin | truncate((lead_p_truncate + 3), \"...\");\n\t\t\t\t\t\t\t\t\t\t\tend;\n\t\t\t\t\t\t\t\t\t%]\n\t\t\t\t\t\t\t\t\t\t<div class=\"panel-leadin\">\n\t\t\t\t\t\t\t\t\t\t\t[% leadin; %] \n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t\t\t\t\t[% end %]\n\n\t\t\t\t\t\t\t\t\t[% if show_related == true && asset.items | length > 0 -%]\n\t\t\t\t\t\t\t\t\t\t<div class=\"related items\">\n\t\t\t\t\t\t\t\t\t\t\t<ul class=\"blox-related-items\">\n\t\t\t\t\t\t\t\t\t\t\t\t[%-\tforeach asset.items as child;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif child.type == 'video' || child.type == 'audio';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype = child.type;\n\t\t\t\t\t\t\t\t\t\t\t\t\telse;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype = 'related';\n\t\t\t\t\t\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"[% child.url %]\" title=\"[% child.title | html %]\" class=\"child-icon [% type %]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"child-type\">[% type | titlecase %]:</span> [% if child.title | length > 35; echo child.title | truncate(35,'...'); else; echo child.title; end; %]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\t\t[%\tend %]\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t[% end;  %]\n\t\t\t\t\t\t\t\t\t<div class=\"panel-extras\">\n\t\t\t\t\t\t\t\t\t\t\t[% if comment_count | strbool == true; %]\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"comment-count\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t[% core_base_library_comment_count; %]\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t\t\t\t\t\t\t[% end %]\n\t\t\t\t\t\t\t\t\t\t<div class=\"keyword-tags\">\n\t\t\t\t\t\t\t\t\t\t\t[% if show_keywords | strbool == true;\n\t\t\t\t\t\t\t\t\t\t\t\tcore_base_library_assetKeywords;\n\t\t\t\t\t\t\t\t\t\t\tend; %]\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t</li>\n\t\t\t\t\n\t\t\t\t\t[%\tasset_iter = asset_iter + 1;\n\t\t\t\t\t\tpanel_item_count = panel_item_count + 1;\n\t\t\t\t\tend;\n\t\t\t\tend;%]\n\t\t\t</ul>\n\n\t\t\t[% if nav_item_location == 'right' || nav_item_location == 'bottom';\n\t\t\t\tbuild_slideshow_presentation_nav_items;\n\t\t\tend; %]\n\t\t\n\t\t\t<div class=\"clear\"></div>\n\t\t\t\n\t\t</div>\n\n\t\t<script type=\"text/javascript\">\n\t\t\tvar sliderPresentationId = \"#slideshow-presentation-[% slideshow_presentation_instance %]\";\n\t\t\t$(document).ready(function() {\n\t\t\t\tvar sliderPresentationId = \"#slideshow-presentation-[% slideshow_presentation_instance %]\";\n\t\t\t\t$(sliderPresentationId + \" .slideshow-presentation-nav-item a\").click(function(event) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t});\n\n\t\t\t/* rotation function */\n\t\t\t\tvar changePanelTimeout;\n\t\t\t\tvar currIndex = -1;\n\t\t\t\tvar currPanel;\n\t\t\t\tvar currNav;\n\t\t\t\tvar newIndex;\n\t\t\t\tvar newPanel;\n\t\t\t\tvar totalPanels;\n\t\t\t\tvar newIndex = -1;\n\t\t\t\t\n\t\t\t\tfunction changePanel(newIndex){\n\t\t\t\t\tclearTimeout(changePanelTimeout);\n\t\t\t\t\tvar currPanel = $(sliderPresentationId + \" li.slideshow-presentation-panel-item.active-panel\");\n\t\t\t\t\tvar currNav = $(sliderPresentationId + \" li.slideshow-presentation-nav-item.active-nav\");\n\t\t\t\t\tif(typeof newIndex == \"undefined\") {\n\t\t\t\t\t\tif(currPanel.next().length == 0) {\n\t\t\t\t\t\t\tcurrPanel.clearQueue().fadeTo(100,0).removeClass(\"active-panel\");\n\t\t\t\t\t\t\tcurrNav.removeClass(\"active-nav\");\n\t\t\t\t\t\t\tcurrPanel.css(\"display\", \"none\");\n\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").eq(0).addClass(\"active-nav\");\n\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-panel-item\").eq(0).clearQueue().fadeTo(100,1).addClass(\"active-panel\");\n\t\t\t\t\t\t} else { \n\t\t\t\t\t\t\tcurrNav.removeClass(\"active-nav\");\n\t\t\t\t\t\t\tcurrPanel.clearQueue().fadeTo(100,0).removeClass(\"active-panel\");\n\t\t\t\t\t\t\tcurrPanel.css(\"display\", \"none\");\n\t\t\t\t\t\t\tcurrPanel.clearQueue().next().fadeTo(100,1).addClass(\"active-panel\");\n\t\t\t\t\t\t\tcurrNav.next().addClass(\"active-nav\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { \n\t\t\t\t\t\t\tcurrNav.removeClass(\"active-nav\");\n\t\t\t\t\t\t\tcurrPanel.clearQueue().fadeTo(100,0).removeClass(\"active-panel\");\n\t\t\t\t\t\t\tcurrPanel.css(\"display\", \"none\");\n\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-panel-item\").eq(newIndex).clearQueue().fadeTo(100,1).addClass(\"active-panel\");\n\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").eq(newIndex).addClass(\"active-nav\");\n\t\t\t\t\t}\n\t\t\t\t\tchangePanelTimeout = setTimeout(changePanel,[% delay_interval %]);     \n\t\t\t\t}\n\n\t\t\t\tchangePanel(0);\n\t\t\t\t\t\t\t\n\t\t\t/* Stop rotation on panel hover */\n\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-panel-item\").hover(\n\t\t\t\tfunction() {\n\t\t\t\t\t\tclearTimeout(changePanelTimeout);\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tchangePanelTimeout = setTimeout(changePanel,[% delay_interval %]);\n\t\t\t\t\t});\n\n\t\t\t/* Navigation item behavior */\n\t\t\t\t[% if panel_nav_trigger == \"hover\" %]\t\t\t\t\n\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").hover(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tif($(this).index() != $(sliderPresentationId + \" li.slideshow-presentation-panel-item.active-panel\").index()) {\n\t\t\t\t\t\t\tchangePanel($(sliderPresentationId + \" li.slideshow-presentation-nav-item\").index(this));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclearTimeout(changePanelTimeout);\n\t\t\t\t\t},function() {\n\t\t\t\t\t\tchangePanelTimeout = setTimeout(changePanel,[% delay_interval %]);\n\t\t\t\t\t});\n\t\t\t\t\t[% if cms.system.venue != \"admin\"; \n\t\t\t\t\t\tfor ad_slots as ad_nav_title; \n\t\t\t\t\t\t\tad_slot_iter = ad_nav_title - 1; %]\n\t\t\t\t\t\t\tif(adClickURLs[[% ad_nav_title | iterpos %]] != '') {\n\t\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").eq([% ad_slot_iter %]).attr(\"onclick\", 'window.location = (\"' + adClickURLs[[% ad_nav_title | iterpos %]] + '\")');\t\t\t\n\t\t\t\t\t\t\t} else { \n\t\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").eq([% ad_slot_iter %]).find(\"a\").css(\"text-decoration\", \"none !important\").click(function(event) {\n\t\t\t\t\t\t\t\tevent.preventDefault();\t\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t[% \tend;\n\t\t\t\t\tend;\n\t\t\t\telse %]\n\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").click(function() {\n\t\t\t\t\t\tchangePanel($(sliderPresentationId + \" li.slideshow-presentation-nav-item\").index(this));\n\t\t\t\t\t});\n\t\t\t\t[% end %]\n\t\t\t\t\n\t\t\t\t[% for ad_slots as ad_nav_title;\n\t\t\t\t\t\tad_slot_iter = ad_nav_title - 1;\n\t\t\t\t\t\tif ad_title_type == \"internal\"; %]\n\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").eq([% ad_slot_iter %]).find(\"a span\").text(adNavTitles[[% ad_nav_title | iterpos %]]);\t\t\t\t\n\t\t\t\t\t\t[% end; %]\n\t\t\t\t\t\t[% if navigation_orientation == \"horizontal\";  %]\n\t\t\t\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item\").eq([% ad_slot_iter %]).css({\"background-image\": \"url(\" + adNavBGs[[% ad_nav_title | iterpos %]] + \")\", \"background-position\": \"50% 50%\"});\n\t\t\t\t\t\t[% end %]\n\t\t\t\t[% end; %]\n\t\t\t});\n\n\t\t\t/* Set first and last navigation items, and fade in first panel */\n\t\t\t\t/* $(sliderPresentationId + ' li.slideshow-presentation-nav-item').eq(0).addClass(\"first-in-list\");\n\t\t\t\t$(sliderPresentationId + ' li.slideshow-presentation-nav-item').eq(($(sliderPresentationId + ' li.slideshow-presentation-nav-item').length)-1).addClass(\"last-in-list\"); */\n\t\t\t\n\t\t\t[% if navigation_orientation == \"vertical\" %]\n\t\t\t\t$(sliderPresentationId + \" li.slideshow-presentation-nav-item a.link\").each(function() {\n\t\t\t\t\tvar nParentHeight = $(this).parent().height();var nSelfHeight = $(this).height();var nMarginTop = (nParentHeight - nSelfHeight) / 2;$(this).css(\"margin-top\", nMarginTop + \"px\");\n\t\t\t\t});\n\t\t\t[% end %]\n\t\t</script>\n\t[% end %]\n\t<!--[if gte IE 9]>\n<style type=\"text/css\">\n    .blox-ie-no-filter {\n       filter: none;\n    }\n  </style>\n<![endif]-->"
    }
  }
]
